<!DOCTYPE html>
<html>
  <head>
    <title>Eurail 2015 Tour</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <link rel="shortcut icon" href="https://carto.com/favicon.ico" />
<!-- W3.css because I'm a n00b -->
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <!-- There's a map in my room on the wall of my room -->
    <style>
      html, body {

      }

      #map {
        height: 100%;
        padding: 0;
        margin: 0;

      }

    button, .progress, .grid, .column {
      position: fixed;
      display: inline;
      bottom: 20%;
      z-index: 3;
    }

    .grid {
      width: 100%;
      padding: 30%;
    }

.progress {
  position: relative;
  top: 50%;
  transform: translateY(-50%);

}



    .right {

margin-right: 30px;
    }

    .left {
margin-left: 30px;
    }



    .nav {
      position: fixed;
      top: 50px;
      z-index: -1;
      left:auto;
    }

    .bottom {

      height: 80vh;
       padding: 30px;
    }

    .menu {

      height: 60px;
    }



    </style>

    <link rel="stylesheet" href="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/themes/css/cartodb.css" />
    <link rel="stylesheet" href="/semantic/semantic.css" />

  </head>
  <body>
<!--
    <div class="ui inverted menu nav">
    <a class="active item">
      Map
    </a>
    <a class="item">
      Figures
    </a>
    <a class="item">
      Citations
    </a>
    <a class="item">
      About
    </a>
  </div> -->

  <div class="ui top attached tabular menu">
    <a class="active item" data-tab="map">
      Map
    </a>
    <a class="item" data-tab="figures">
      Figures
    </a>
    <a class="item" data-tab="citations">
      Citations
    </a>
    <a class="item" data-tab="about">
      About
    </a>

  </div>

  <!-- map -->
<div class="ui bottom attached segment" data-tab="map">
    <div id="map"></div>


<div class="ui grid equal width">
  <div class="column">
<center>
    <button class="ui left labeled icon button" onclick="navigateLocationsBackward()">
      <i class="left arrow icon"></i>
      Back
    </button>
</center>
  </div>
  <div class="column">

    <div class="ui teal progress" >
      <div class="bar"></div>
    </div>

  </div>
  <div class="column">
<center>
    <button class="ui right labeled icon button" onclick="navigateLocationsForward()">
      <i class="right arrow icon"></i>
      Next
    </button>
</center>
  </div>

</div>


</div>



    <!-- include cartodb.js library -->
    <script src="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/cartodb.js"></script>
<script src="/semantic/semantic.js"></script>

    <!-- Drop your code between the script tags below! -->
    <script>

    var locationNumber = -1; // helps cycle through locations
    var locations; // array of all points
    var pointsLayer; // holds the layer for the points so we can open the info windows programattically

    $.getJSON("/data/points.json", function(json) {
      //console.log(json); // this will show the info it in firebug console
      createPlaceArray(json);
  });


  // opens info window programattically
  function openInfoWindow(layer, latlng, cartodb_id) {
    console.log(layer);
    layer.on('featureOver', function(e, latlng, pos, data, subLayerIndex) {
      console.log("mouse over polygon with data: " + data);
    });
    }


// callback function for the getJSON that gets the json data
function createPlaceArray(json) {

locations = json;
console.log("locations");
console.log(locations);
}

// callback function that sets the layer into pointsLayer
function setPointsLayer(layerFromLayerArray) {
  pointsLayer = layerFromLayerArray;
  console.log(pointsLayer);
}




    // Choose center and zoom level
    var options = {
      center: [44, 0.2784], // Saguntum 39.6799° N, 0.2784° W
      zoom: 2
    }

    // Instantiate map on specified DOM element
    var map_object = new L.Map(map, options);
    window.onload = function() {
console.log("we're loading at least");

      // Add a basemap to the map object just created
      L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Stamen'
      }).addTo(map_object);
console.log("we've gotten this far");
      var vizjson = 'https://olivierid.carto.com/api/v2/viz/8c423dd7-69d1-4cad-a659-0314ee1593d7/viz.json';
cartodb.createLayer(map_object, vizjson).addTo(map_object).done(function(layers) {
          // layer 0 is the base layer, layer 1 is cartodb layer
          console.log(layers.layers);

        //  sets the point layer to the response we get from this function
        setPointsLayer(layers.layers[0]);

        })
        .error(function(err) {
          console.log(err);
        });

          console.log(pointsLayer);
      }




    // takes us to Philly
    // used in case of an error
    // because it's always sunny in Philadelphia

    zoomToPhiladelphia = function() {

    map_object.setView([41.9028, 75.1652], 7);
    console.log("City of Brotherly love");

    }

    // takes us to Rome
    // used in case of an error
    // because it's always a good idea to go to Rome when things aren't working out

    zoomToRome = function() {

    map_object.setView([39.9526, 12.4964], 7);
    console.log("the Eternal city");

    }

    // for when they click the next button
    // tries to cycle through the places given to it by the json object
    function navigateLocationsForward(){
      // if we don't have data from locations, just go to Rome
      if (locations == null){
          zoomToRome();
      }
      else {

        if(locationNumber == locations.length){
          locationNumber = 0;
        }
        else {
          locationNumber++; // increment so it will be the next place next time
        }

        // open info window, not working
      //  openInfoWindow(pointsLayer, null, locations[locationNumber].cartodb_id);


      // increment progress bar
      // for progress bar
      $('.progress')
    .progress('increment');

        console.log(locations[locationNumber].cartodb_id);

        let latitude = locations[locationNumber].latitude;
        let longitude = locations[locationNumber].longitude;

        map_object.setView([latitude, longitude], 7);

        // this takes you back to the beginning once you've finished


      }


    }

    // for when they click the back button
    // tries to cycle backwards through the places given to it by the json object
    function navigateLocationsBackward(){
      // if we don't have data from locations, just go to Rome
      if (locations == null){
          zoomToRome();
      }
      else {

        if (locationNumber == 0) {
          locationNumber = 19;
        }
        else{
          locationNumber-= 1; // decrement so it will be the next place next time
          console.log(locationNumber);

          // decrement progress bar
          $('.progress')
        .progress('decrement');

          let latitude = locations[locationNumber].latitude;
          let longitude = locations[locationNumber].longitude;

          map_object.setView([latitude, longitude], 7);
        }



      }


    }

    // initialize progress bar
    $('.progress').progress({total: locations.length});

    </script>

  </body>
</html>
